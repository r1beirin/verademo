trigger:
- main
pool:
  vmImage: 'ubuntu-latest'

steps:
# - task: VeracodeCommunityScaAdoExtension@1
#   inputs:
#     scanType: 'directory'
#     scanTarget: '.'
#     minCVSS: '5'

- task: CmdLine@2
  inputs:
    script: |
      /usr/bin/curl -sSL https://download.sourceclear.com/ci.sh | /usr/bin/sh -s -- scan . --recursive

# stages:
# - stage: Build
#   jobs:
#   - job: Build
#     steps: 
#     - task: Maven@3
#       displayName: 'Buildando com o Maven'
#       inputs:
#         mavenPomFile: 'app/pom.xml'
#         mavenOptions: '-Xmx3072m'
#         javaHomeOption: 'JDKVersion'
#         jdkVersionOption: '1.8'
#         jdkArchitectureOption: 'x64'
#         publishJUnitResults: true
#         testResultsFiles: '**/surefire-reports/TEST-*.xml'
#         goals: 'package'

#     - task: PublishPipelineArtifact@1
#       displayName: 'Publicando o .war'
#       inputs:
#         targetPath: 'app/target/verademo.war'
#         artifact: 'drop'
#         publishLocation: 'pipeline'

# - stage: SCA
#   displayName: SCA
#   dependsOn: Build
#   jobs:
#   - job: SCA
#     displayName: 'Veracode SCA'
#     steps:
#     - task: CmdLine@2
#       inputs:
#         script: |
#           export SRCCLR_API_TOKEN=$(SRCCLR_API_TOKEN)
#           curl -sSL https://download.sourceclear.com/ci.sh | bash -s â€“ scan --update-advisor --allow-dirty
#       displayName: 'Resultados SCA'
#       continueOnError: true